name: StegVerse SCW Orchestrator

on:
  workflow_dispatch:
    inputs:
      target_repo:
        description: "Repo to autopatch (e.g. StegVerse-Labs/TVC)"
        required: true
      command:
        description: "SCW command: self-test or autopatch"
        required: true
        default: "self-test"

jobs:
  scw:
    runs-on: ubuntu-latest

    steps:
      - name: Set up job
        run: echo "Starting SCW job..."

      - name: Checkout SCW repo
        uses: actions/checkout@v4

      - name: Set git identity (required for autopatch commits)
        run: |
          git config --global user.email "scw-bot@stegverse.ai"
          git config --global user.name "StegVerse-AI"

      - name: Install dependencies
        run: pip install -r scw/requirements.txt

      - name: Run SCW core
        run: |
          echo "Running SCW core..."
          python scw/scw_core.py \
            "${{ github.event.inputs.command }}" \
            --target-repo "${{ github.event.inputs.target_repo }}" \
            --org "StegVerse-Labs"

      - name: Post Checkout SCW repo
        if: always()
        run: echo "SCW job finished."
